---
import path from "path";
import PostMetadata from "./PostMeta.astro";
import ImageWrapper from "./misc/ImageWrapper.astro";
import { Icon } from "astro-icon/components";
import { getDir } from "../utils/url-utils";

interface Props {
  class?: string;
  entry: any;
  title: string;
  url: string;
  published: Date;
  tags: string[];
  category: string;
  image: string;
  description: string;
  draft: boolean;
  style: string;
}
const {
  entry,
  title,
  url,
  published,
  tags,
  category,
  image,
  description,
  style,
} = Astro.props;
const className = Astro.props.class;

const hasCover = image !== undefined && image !== null && image !== "";

const { remarkPluginFrontmatter } = await entry.render();
---

<article class:list={["horizontal-card group", className]} style={style}>
  <div class="flex flex-col md:flex-row h-full">
    <!-- Thumbnail -->
    <div class="md:w-1/3 flex-shrink-0">
      <a
        href={url}
        aria-label={title}
        class="block h-full overflow-hidden rounded-lg md:rounded-r-none"
      >
        {
          hasCover ? (
            <ImageWrapper
              src={image}
              basePath={path.join("content/posts/", getDir(entry.id))}
              alt="Cover Image of the Post"
              class="w-full h-48 md:h-full object-cover transition-transform duration-300 group-hover:scale-105"
            />
          ) : (
            <div class="w-full h-48 md:h-full bg-gradient-to-br from-[var(--primary)]/10 to-[var(--primary)]/5 flex items-center justify-center">
              <Icon
                name="material-symbols:article-outline"
                class="text-3xl text-[var(--primary)]/50"
              />
            </div>
          )
        }
      </a>
    </div>

    <!-- Content -->
    <div class="flex-1 p-6 flex flex-col justify-between">
      <div>
        <!-- Title -->
        <a
          href={url}
          class="transition block font-sans font-semibold mb-3 text-xl text-90 leading-tight tracking-wide
            hover:text-[var(--primary)] dark:hover:text-[var(--primary)]
            active:text-[var(--title-active)] dark:active:text-[var(--title-active)]"
        >
          {title}
        </a>

        <!-- Excerpt -->
        <div
          class="transition text-65 mb-4 font-serif text-sm leading-relaxed line-clamp-2"
        >
          {description || remarkPluginFrontmatter.excerpt}
        </div>
      </div>

      <!-- Metadata -->
      <PostMetadata
        published={published}
        tags={tags}
        category={category}
        hideTagsForMobile={false}
        class="mt-auto"
      />
    </div>
  </div>
</article>
